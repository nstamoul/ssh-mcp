# MCP SSH HTTP Server - Docker Compose Configuration
# Designed to work with MCP Gateway (Caddy reverse proxy)
#
# This service connects to the mcp_gateway network for routing through
# the centralized Caddy reverse proxy at mcp.orb.local
#
# Usage:
#   docker compose up -d        # Start service
#   docker compose logs -f      # View logs
#   docker compose down         # Stop service

services:
  ssh-mcp-server:
    image: mcp-ssh-server:latest
    container_name: ssh-mcp-server
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped

    # Environment configuration
    environment:
      - NODE_ENV=production
      - PORT=3009
      - HOST=0.0.0.0
      - DEBUG=false
      # Uncomment for debug logging:
      # - DEBUG=true

    # Health check
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:3009/healthz').then(r => r.ok ? process.exit(0) : process.exit(1)).catch(() => process.exit(1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
